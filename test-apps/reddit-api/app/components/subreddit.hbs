{{page-title @subreddit}}
<section
  data-machine={{this.subredditMachine.state.machine.id}}
  {{! @glint-expect-error: I need a string here. }}
  data-state={{this.subredditMachine.state.value}}
  ...attributes
>
  {{#if (this.subredditMachine.state.matches "loading") }}
    <div>Loading posts...</div>
  {{/if}}

  {{#if (this.subredditMachine.state.matches "loaded") }}
    <header>
      <h3 class="capitalize text-xl font-bold text-gray-900">{{@subreddit}}</h3>

      <small>
        {{! @glint-expect-error: Once I figure out how to declare the type for subredditMachine, then context.lastUpdated should have a type }}
        Last updated: {{this.formatDate this.subredditMachine.state.context.lastUpdated}}
        <button {{on "click" this.refreshSubreddit}} type="button"
          class="bg-blue-500 hover:bg-blue-700 text-xs ml-1 text-white px-2 py-1 rounded-full"
        >Refresh</button>
      </small>
    </header>
    <ul>
      {{! @glint-expect-error: Once I figure out how to declare the type for subredditMachine, then context.posts should have a type }}
      {{#each this.subredditMachine.state.context.posts as |post|}}
        <li class="p-4 border-b-2">
          <span>{{post.title}}</span>
        </li>
      {{/each}}
    </ul>
  {{/if}}

  {{#if (this.subredditMachine.state.matches "failure") }}
    <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4">
      <p>Could not load posts</p>
      <button {{on "click" this.retrySubreddit}} type="button"
        class="bg-blue-500 hover:bg-blue-700 mt-4 text-white px-4 py-2 rounded-full"
      >Retry</button>
    </div>
  {{/if}}
</section>
